import{_ as tt}from"./index-858e7551.js";import{f as at}from"./index-0358cb65.js";import{a as V}from"./element-plus-7da03efa.js";import{k as F,aN as et,e as ot,$ as lt,f as nt,i as st,_ as it,ah as r,ar as rt,o as i,c as b,W as s,Q as n,a as u,F as I,a9 as T,U as c,P as d,R as pt,T as y,u as dt,V as h}from"./@vue-d9027515.js";import"./pinia-be7e992d.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-a2fac16f.js";import"./vue-i18n-e0b9a81d.js";import"./@intlify-9e8a497c.js";import"./source-map-7d7e1c08.js";import"./vue-b46b26c7.js";import"./js-cookie-cf83ad76.js";import"./@element-plus-96a31696.js";import"./nprogress-8d2808ea.js";import"./axios-707ed124.js";import"./qs-bbfcbdf3.js";import"./side-channel-eafc5c70.js";import"./get-intrinsic-b9397c9a.js";import"./has-symbols-e8f3ca0e.js";import"./function-bind-22e7ee79.js";import"./has-26d28e02.js";import"./call-bind-9ceb8f5b.js";import"./object-inspect-7b08a46e.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-0ee01be3.js";import"./lodash-es-36eb724a.js";import"./@vueuse-2d9216d7.js";import"./@ctrl-f8748455.js";import"./dayjs-6aac7dfa.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-463e90e0.js";import"./requestFSGet-6e3c6110.js";const ut={class:"system-user-container layout-padding"},ct={class:"system-user-search mb15"},gt={class:"flex-warp",style:{background:"#e0e0e0"}},mt=["onClick"],ft={class:"appItem"},_t={class:"appItem"},bt={class:"appItem"},ht={class:"appItem"},Dt={class:"appItem"},yt={class:"appItem"},vt=u("h3",{style:{padding:"5px"}},"构建队列",-1),It=["innerHTML"],wt=F({name:"fopsApp"}),sa=F({...wt,setup(Lt){const g=at(),G=et(()=>tt(()=>import("./dialog-847e567f.js"),["assets/js/dialog-847e567f.js","assets/js/index-0358cb65.js","assets/js/index-858e7551.js","assets/js/@vue-d9027515.js","assets/js/pinia-be7e992d.js","assets/js/vue-demi-71ba0ef2.js","assets/js/vue-router-a2fac16f.js","assets/js/vue-i18n-e0b9a81d.js","assets/js/@intlify-9e8a497c.js","assets/js/source-map-7d7e1c08.js","assets/js/vue-b46b26c7.js","assets/js/js-cookie-cf83ad76.js","assets/js/@element-plus-96a31696.js","assets/js/nprogress-8d2808ea.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-707ed124.js","assets/js/qs-bbfcbdf3.js","assets/js/side-channel-eafc5c70.js","assets/js/get-intrinsic-b9397c9a.js","assets/js/has-symbols-e8f3ca0e.js","assets/js/function-bind-22e7ee79.js","assets/js/has-26d28e02.js","assets/js/call-bind-9ceb8f5b.js","assets/js/object-inspect-7b08a46e.js","assets/js/element-plus-7da03efa.js","assets/js/lodash-es-36eb724a.js","assets/js/@vueuse-2d9216d7.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-6aac7dfa.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-1d60d822.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-463e90e0.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-0ee01be3.js","assets/css/index-c2520709.css","assets/js/requestFSGet-6e3c6110.js","assets/css/detailDialog-2d838ab0.css"])),v=ot(),t=lt({logDialogIsShow:!1,logContent:"",tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:12}},tableLogData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:12}},appName:"",logId:0,clusterId:0,clusterData:[]}),w=()=>{t.tableData.loading=!0;const a=[];g.appsList({}).then(function(e){if(e.Status){for(let p=0;p<e.Data.length;p++){var l=e.Data[p];l.FrameworkGitsStr=Q(l.FrameworkGits),l.AppGitStr=W(l.AppGit),a.push(l)}setTimeout(()=>{t.tableData.data=a,t.tableData.total=a.length,t.tableData.loading=!1},500)}else t.tableData.data=[],setTimeout(()=>{t.tableData.loading=!1},500)})},m=()=>{t.tableLogData.loading=!0;const a={appName:"",pageIndex:t.tableLogData.param.pageNum,pageSize:t.tableLogData.param.pageSize};g.buildList(a).then(function(e){e.Status?(t.tableLogData.data=e.Data.List,t.tableLogData.total=e.Data.RecordCount,t.tableLogData.loading=!1):(t.tableLogData.data=[],t.tableLogData.loading=!1)})},$=()=>{t.tableData.loading=!0,g.clusterList({}).then(function(a){if(a.Status){var e=[];for(let p=0;p<a.Data.length;p++){var l=a.Data[p];p==0&&(t.clusterId=l.Id),l.Name=l.Name+" - "+l.DockerName,e.push(l)}t.clusterData=e}else t.tableData.data=[]})},B=a=>{t.clusterId=a},R=a=>{v.value.openDialog(a)},U=(a,e)=>{v.value.openDialog(a,e)},E=a=>{t.tableLogData.param.pageSize=a,m()},H=a=>{t.appName=a.AppName,t.tableLogData.param.pageNum=1,t.tableLogData.param.pageSize=10,m()},M=a=>{t.tableLogData.param.pageNum=a,m()};let L=null;nt(()=>t.logDialogIsShow,(a,e)=>{a?L=setInterval(O,1e3):clearInterval(L)});const P=a=>{t.logId=a.Id,g.buildLog(t.logId.toString()).then(function(e){t.logContent=e,t.logDialogIsShow=!0})},O=()=>{g.buildLog(t.logId.toString()).then(function(a){console.log(a),t.logContent=a})},j=a=>{var e={AppName:a.AppName,ClusterId:t.clusterId};g.buildAdd(e).then(async function(l){l.Status?(V.success("添加成功"),m()):V.error(l.StatusMessage)})},Q=a=>{var e=[];for(let l=0;l<a.length;l++)g.gitInfo({gitId:a[l]}).then(function(p){p.Status&&e.push(p.Data.Name)});return e},W=a=>{var e=[];return g.gitInfo({gitId:a}).then(function(l){l.Status&&e.push(l.Data.Name)}),e};let k=null;return st(()=>{w(),m(),$(),k=setInterval(m,1e3)}),it(()=>{clearInterval(k)}),(a,e)=>{const l=r("el-option"),p=r("el-select"),q=r("ele-FolderAdd"),J=r("el-icon"),D=r("el-button"),f=r("el-tag"),S=r("el-col"),C=r("el-empty"),N=r("el-row"),_=r("el-table-column"),K=r("el-table"),X=r("el-pagination"),z=r("el-card"),Y=r("el-dialog"),Z=rt("loading");return i(),b("div",ut,[s(z,{shadow:"hover",class:"layout-padding-auto"},{default:n(()=>[u("div",ct,[s(p,{modelValue:t.clusterId,"onUpdate:modelValue":e[0]||(e[0]=o=>t.clusterId=o),placeholder:"请选择集群",class:"ml10",onChange:B},{default:n(()=>[(i(!0),b(I,null,T(t.clusterData,o=>(i(),d(l,{key:o.Id,label:o.Name,value:o.Id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(D,{size:"default",type:"success",class:"ml10",onClick:e[1]||(e[1]=o=>R("add"))},{default:n(()=>[s(J,null,{default:n(()=>[s(q)]),_:1}),c(" 新增应用 ")]),_:1})]),u("div",gt,[s(N,{style:{float:"left",width:"65%"}},{default:n(()=>[t.tableData.data.length>0?(i(),d(S,{key:0,style:{float:"left",margin:"10px"},xs:24,sm:24,md:24,lg:24,xl:24,class:"mb15"},{default:n(()=>[(i(!0),b(I,null,T(t.tableData.data,(o,x)=>(i(),b("div",{style:{background:"#ffffff",width:"24%"},class:"flex-warp-item",key:x},[u("div",{class:"flex-warp-item-box",onClick:A=>H(o)},[u("div",ft,[s(f,{size:"mini"},{default:n(()=>[c(h(o.AppName),1)]),_:2},1024),o.IsHealth?(i(),d(f,{key:0,size:"mini",type:"success"},{default:n(()=>[c("健康")]),_:1})):(i(),d(f,{key:1,size:"mini",type:"warning"},{default:n(()=>[c("不健康")]),_:1}))]),u("div",_t,"容器版本："+h(o.DockerVer),1),u("div",bt,"集群版本："+h(o.ClusterVer),1),u("div",ht,"仓库："+h(o.AppGitName),1),u("div",Dt,"容器文件路径："+h(o.DockerfilePath),1),u("div",yt,[s(D,{size:"default",onClick:A=>U("edit",o),type:"warning"},{default:n(()=>[c("修改")]),_:2},1032,["onClick"]),s(D,{onClick:A=>j(o),size:"default",type:"danger"},{default:n(()=>[c("构建")]),_:2},1032,["onClick"])])],8,mt)]))),128))]),_:1})):(i(),d(C,{key:1,description:"暂无数据"}))]),_:1}),s(N,{style:{width:"35%",float:"left"}},{default:n(()=>[t.tableLogData.data.length>0?(i(),d(S,{key:0,style:{float:"left",background:"#ffffff",margin:"15px 10px 10px 0",padding:"5px",width:"98%"},xs:24,sm:24,md:24,lg:24,xl:24,class:"mb15"},{default:n(()=>[vt,t.tableLogData.data.length>0?(i(),b(I,{key:0},[pt((i(),d(K,{data:t.tableLogData.data,style:{width:"100%",background:"#ffffff"}},{default:n(()=>[s(_,{prop:"Id",label:"编号",width:"70"}),s(_,{prop:"AppName",label:"应用名称"}),s(_,{label:"状态",width:"90","show-overflow-tooltip":""},{default:n(o=>[o.row.Status==0?(i(),d(f,{key:0,size:"mini",type:"info"},{default:n(()=>[c("未开始")]),_:1})):y("",!0),o.row.Status==1?(i(),d(f,{key:1,size:"mini",type:"success"},{default:n(()=>[c("构建中")]),_:1})):y("",!0),o.row.Status==2?(i(),d(f,{key:2,size:"mini"},{default:n(()=>[c("完成")]),_:1})):y("",!0)]),_:1}),s(_,{prop:"FinishAt",width:"170",label:"完成时间"}),s(_,{label:"操作",width:"80"},{default:n(o=>[s(D,{size:"small",type:"success",onClick:x=>P(o.row)},{default:n(()=>[c("日志")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,t.tableLogData.loading]]),s(X,{onSizeChange:E,onCurrentChange:M,class:"mt15","pager-count":5,"page-sizes":[10,20,30],"current-page":t.tableLogData.param.pageNum,"onUpdate:currentPage":e[2]||(e[2]=o=>t.tableLogData.param.pageNum=o),background:"","page-size":t.tableLogData.param.pageSize,"onUpdate:pageSize":e[3]||(e[3]=o=>t.tableLogData.param.pageSize=o),layout:"total, sizes, prev, pager, next, jumper",total:t.tableLogData.total},null,8,["current-page","page-size","total"])],64)):y("",!0)]),_:1})):(i(),d(C,{key:1,description:"暂无数据"}))]),_:1})])]),_:1}),s(dt(G),{ref_key:"appDialogRef",ref:v,onRefresh:e[4]||(e[4]=o=>w())},null,512),s(Y,{title:"构建日志",modelValue:t.logDialogIsShow,"onUpdate:modelValue":e[5]||(e[5]=o=>t.logDialogIsShow=o),style:{width:"80%",height:"85%",top:"20px","margin-bottom":"50px"}},{default:n(()=>[s(z,{shadow:"hover",class:"layout-padding-auto",style:{"background-color":"#393d49",overflow:"auto"}},{default:n(()=>[u("pre",{style:{color:"#fff","background-color":"#393d49",height:"100%"},innerHTML:t.logContent},null,8,It)]),_:1})]),_:1},8,["modelValue"])])}}});export{sa as default};
